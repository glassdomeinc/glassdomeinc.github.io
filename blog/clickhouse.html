<!doctype html>
<html lang="ko" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Installing Clickhouse on Kubernetes Hosted by NCloud and NHN Cloud | 글래스돔코리아 기술블로그</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://blog.glassdome.cloud/blog/clickhouse"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Installing Clickhouse on Kubernetes Hosted by NCloud and NHN Cloud | 글래스돔코리아 기술블로그"><meta data-rh="true" name="description" content="This is a walkthrough of what I did to setup clickhouse databases on Kubernetes"><meta data-rh="true" property="og:description" content="This is a walkthrough of what I did to setup clickhouse databases on Kubernetes"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-11-03T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/dcl3"><meta data-rh="true" property="article:tag" content="clickhouse,kubernetes,helm,ncloud,nhn cloud"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.glassdome.cloud/blog/clickhouse"><link data-rh="true" rel="alternate" href="https://blog.glassdome.cloud/blog/clickhouse" hreflang="ko"><link data-rh="true" rel="alternate" href="https://blog.glassdome.cloud/en/blog/clickhouse" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.glassdome.cloud/blog/clickhouse" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://CLZDAQBR47-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="글래스돔코리아 기술블로그 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="글래스돔코리아 기술블로그 Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="글래스돔코리아 기술블로그" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.f0c66f30.css">
<link rel="preload" href="/assets/js/runtime~main.763d51bd.js" as="script">
<link rel="preload" href="/assets/js/main.d52ff28f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Glassdome Logo" class="themedImage_ToTc themedImage--light_HNdA" style="padding:0 0 0 0"><img src="/img/logo.png" alt="Glassdome Logo" class="themedImage_ToTc themedImage--dark_i4oU" style="padding:0 0 0 0"></div><b class="navbar__title text--truncate">글래스돔코리아</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">기술블로그</a><a class="navbar__item navbar__link" href="/blog/tags">태그</a><a class="navbar__item navbar__link" href="/blog/archive">목록</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/recruit">Recruit</a><a href="https://github.com/glassdomeinc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="검색"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">검색</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="최근 블로그 문서 둘러보기"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/persistent-storage-increase">How to increase persistent storage capacity for a stateful set on K8s with no downtime</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/krakend">Creating an API Gateway for your backend with KrakenD</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/goqu-tutorial">Start using Goqu to build your SQL Queries in Go</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/lo-example">An example of mapping with lo library in Go</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/cdktf-cloudfront-cloudflare">Deploying an S3 static website with CDK for Terraform on Cloudfront vs Cloudflare</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Installing Clickhouse on Kubernetes Hosted by NCloud and NHN Cloud</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-11-03T00:00:00.000Z" itemprop="datePublished">2022년 11월 3일</time> · <!-- -->약 3분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dcl3" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/56098714?v=4" alt="Mike"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dcl3" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Mike</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer Intern</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>This is a walkthrough of what I did to setup clickhouse databases on Kubernetes</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="intro-to-clickhouse">Intro to Clickhouse<a class="hash-link" href="#intro-to-clickhouse" title="제목으로 바로 가기">​</a></h2><p>Clickhouse is a column-oriented database management system (DBMS) for online analytical processing of queries (OLAP).</p><p>Clickhouse has great performance and can fufill our query needs at Glassdome. We were using Google Bigquery to fufill our databse needs, but the costs were becoming too expensive as we were scaling up. We also adopted a service agnostic approach that prevented us from relying on any one of the service.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installing-clickhouse-onto-kubernetes-cluster-with-helm">Installing Clickhouse onto Kubernetes Cluster with Helm<a class="hash-link" href="#installing-clickhouse-onto-kubernetes-cluster-with-helm" title="제목으로 바로 가기">​</a></h2><p>We used the helm chart managed by <a href="https://artifacthub.io/packages/helm/truecharts/clickhouse" target="_blank" rel="noopener noreferrer">TrueCharts</a> to install Clickhouse.</p><p>We used the following values to configure Clickhouse</p><div class="language-values.yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">values.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-values.yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clickhouseDatabase: &quot;&lt;database name&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clickhouseUsername: &quot;&lt;username&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clickhousePassword: &quot;&lt;password&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timezone: Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  main:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      native:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        targetPort: 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">portal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  main:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using the value file, we installed the helm release</p><div class="language-upgrade.sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">upgrade.sh</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-upgrade.sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add truecharts https://charts.truecharts.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME=&quot;my-clickhouse&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAMESPACE=&quot;clickhouse&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHART=&quot;truecharts/clickhouse&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VERSION=&quot;1.0.41&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install $NAME $CHART --values values.yaml --version $VERSION --namespace $NAMESPACE --create-namespace</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installing-on-ncloud-hosted-kubernetes-cluster">Installing on NCloud hosted Kubernetes Cluster<a class="hash-link" href="#installing-on-ncloud-hosted-kubernetes-cluster" title="제목으로 바로 가기">​</a></h2><p>NCloud should have deployed a storage class so the instructions listed above should work</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installing-on-nhn-cloud">Installing on NHN Cloud<a class="hash-link" href="#installing-on-nhn-cloud" title="제목으로 바로 가기">​</a></h2><p>NHN Cloud is not as well executed as NCloud so there are extra steps that we need before deploying the helm chart</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-a-storage-class">Deploying a Storage Class<a class="hash-link" href="#deploying-a-storage-class" title="제목으로 바로 가기">​</a></h3><p>Following the instructions on the NHN Cloud documentation for <a href="https://gov-docs.toast.com/ko/Container/NKS/ko/gov-user-guide/#2_2" target="_blank" rel="noopener noreferrer">Storage Class</a> we used the following command to create a storage class:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: csi-storageclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provisioner: cinder.csi.openstack.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volumeBindingMode: WaitForFirstConsumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modify-values-of-helm-chart">Modify Values of helm chart<a class="hash-link" href="#modify-values-of-helm-chart" title="제목으로 바로 가기">​</a></h3><p>NHN Cloud Storage has a strange problem where we don&#x27;t have proper permissions to access files in the container that the Clickhouse chart deploys.</p><p>This was quite frustrating because there was no documentation in the helm chart or in NHN Cloud documentation.</p><p>After a lot of trial and error, I got a configuration that was able to give the proper permissions to the container.</p><p>This is definitely not an ideal solution as it just gives root access to the container, but I could not find any other way to get it to work. Set the values as follows:</p><div class="language-values-nhn.yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">values-nhn.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-values-nhn.yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clickhouseDatabase: &quot;&lt;database name&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clickhouseUsername: &quot;&lt;username&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clickhousePassword: &quot;&lt;password&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timezone: Asia/Seoul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  main:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      native:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port: 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        targetPort: 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">portal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  main:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">securityContext:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  runAsGroup: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  runAsNonRoot: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  runAsUser: 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It adds the values for securityContext so it runs as root.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-using-values-nhnyaml">Install using values-nhn.yaml<a class="hash-link" href="#install-using-values-nhnyaml" title="제목으로 바로 가기">​</a></h3><div class="language-upgrade-nhn.yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">upgrade-nhn.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-upgrade-nhn.yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add truecharts https://charts.truecharts.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME=&quot;my-clickhouse&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAMESPACE=&quot;clickhouse&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHART=&quot;truecharts/clickhouse&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VERSION=&quot;1.0.41&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install $NAME $CHART --values values-nhn.yaml --version $VERSION --namespace $NAMESPACE --create-namespace</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing">Testing<a class="hash-link" href="#testing" title="제목으로 바로 가기">​</a></h2><p>Follwing these steps, should result in a working Clickhouse database</p><p>We deployed another application that would send queries to the Clickhouse database onto the Kubernetes Cluster</p><p>Testing in Postman and on the actual production showed it works great</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>노트</div><div class="admonitionContent_S0QG"><p>I hope it was helpful. Thanks</p></div></div></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>태그:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/clickhouse">clickhouse</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/kubernetes">kubernetes</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/helm">helm</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ncloud">ncloud</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/nhn-cloud">nhn cloud</a></li></ul></div></footer></article><div id="disqus_thread"></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="블로그 게시물 탐색"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/cdktf-cloudfront-cloudflare"><div class="pagination-nav__sublabel">이전 게시물</div><div class="pagination-nav__label">Deploying an S3 static website with CDK for Terraform on Cloudfront vs Cloudflare</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/go-minimal-binart-eng"><div class="pagination-nav__sublabel">다음 게시물</div><div class="pagination-nav__label">Go Low Capacity Binary</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#intro-to-clickhouse" class="table-of-contents__link toc-highlight">Intro to Clickhouse</a></li><li><a href="#installing-clickhouse-onto-kubernetes-cluster-with-helm" class="table-of-contents__link toc-highlight">Installing Clickhouse onto Kubernetes Cluster with Helm</a></li><li><a href="#installing-on-ncloud-hosted-kubernetes-cluster" class="table-of-contents__link toc-highlight">Installing on NCloud hosted Kubernetes Cluster</a></li><li><a href="#installing-on-nhn-cloud" class="table-of-contents__link toc-highlight">Installing on NHN Cloud</a><ul><li><a href="#deploying-a-storage-class" class="table-of-contents__link toc-highlight">Deploying a Storage Class</a></li><li><a href="#modify-values-of-helm-chart" class="table-of-contents__link toc-highlight">Modify Values of helm chart</a></li><li><a href="#install-using-values-nhnyaml" class="table-of-contents__link toc-highlight">Install using values-nhn.yaml</a></li></ul></li><li><a href="#testing" class="table-of-contents__link toc-highlight">Testing</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Glassdome. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.763d51bd.js"></script>
<script src="/assets/js/main.d52ff28f.js"></script>
</body>
</html>